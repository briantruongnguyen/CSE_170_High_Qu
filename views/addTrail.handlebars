<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
  <title>HighQu</title>

  <!-- CSS  -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="/css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="/css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>
    
    <style>
  #map {
    height: 80%;
    position:relative;
  }
        #contactform{
            z-index:5;
            position:absolute;
            width: 90%;
            padding-top: 20%;
            padding-left: 10%;
        }
          #warnings{
            top: 56%;
            left: 5%;
            z-index:6;
            position:absolute;
        }
        
           #pointofinterest{
            top: 67%;
            left: 5%;
            z-index:6;
            position:absolute;
        }
        
        #musiclibrary{
            top: 78%;
            left: 5%;
            z-index:6;
            position:absolute;
        }
      #stoprecording{
            width: 100%;
            height: 10%;
        }
   
        #recentermap{
            top: 80%;
            left: 33%;
            z-index:6;
            position:absolute;
        }
        
        #navbar{
            height:10%;
        }
  html, body {
    height: 100%;
    margin: 0;
    padding: 0;
    z-index: 0;
  }
</style>
</head>
<body>
  <nav id="navbar" class="light-green lighten-1" role="navigation">
    <div class="nav-wrapper container"><a id="logo-container" href="#" class="brand-logo">Recording Trail</a>
      <a href="/"><i class="material-icons">backspace</i></a>
    </div>
  </nav>
    
    
    
 
    <a href="#modalwarning" id="warnings"  class="waves-effect btn-floating btn-large red"><i class="material-icons">warning</i></a>
    <a href="#modalpoi" id="pointofinterest" class="waves-effect btn-floating btn-large orange darken-1"><i class="material-icons">local_see</i></a>

    <a href="#modalmusic" id="musiclibrary" class="waves-effect btn-floating btn-large blue darken-1"><i class="material-icons">library_music</i></a>
    
    <a class="waves-effect waves-light blue darken-1 btn" id="recentermap">Recenter<br/>Map</a>


    
    
       <div id="map"></div>
    
       <a href="submitTrail" class="btn-large red" id="stoprecording">Stop Recording</a>

    


    
  
     
       
    
    
    <script>
      var map;
      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: -34.397, lng: 150.644},
          zoom: 20
        });
       // Try HTML5 geolocation.
                      var infoWindow = new google.maps.InfoWindow({map: map});

            if (navigator.geolocation) {
              navigator.geolocation.getCurrentPosition(function(position) {
                var pos = {
                  lat: position.coords.latitude,
                  lng: position.coords.longitude
              };

              infoWindow.setPosition(pos);
              infoWindow.setContent('Location found.');
              map.setCenter(pos);
          }, function() {
            handleLocationError(true, infoWindow, map.getCenter());
        }, 
        {enableHighAccuracy: true}
                                                      
);
          } else {
              // Browser doesn't support Geolocation
              handleLocationError(false, infoWindow, map.getCenter());
          }
          
        poly = new google.maps.Polyline({
          strokeColor: '#000000',
          strokeOpacity: 1.0,
          strokeWeight: 3
        });
        poly.setMap(map);
          
      var shouldCenterMap = true;
      map.addListener('zoom_changed', uncenterMap);
      map.addListener('drag', uncenterMap);
          
      function uncenterMap(){
         shouldCenterMap = false;
         $("#recentermap").show();
          
      }
    
      function centerMap(){
          if (navigator.geolocation) {
              navigator.geolocation.getCurrentPosition(function(position) {
                var pos = {
                  lat: position.coords.latitude,
                  lng: position.coords.longitude
              };

              infoWindow.setPosition(pos);
              infoWindow.setContent('Location found.');
              map.setCenter(pos);
          }, function() {
            handleLocationError(true, infoWindow, map.getCenter());
        }, 
        {enableHighAccuracy: true}
                                                      
);
          } else {
              // Browser doesn't support Geolocation
              handleLocationError(false, infoWindow, map.getCenter());
          }
          
          shouldCenterMap = true;
      }
          
      document.addEventListener('centerMap', centerMap);
          

        
          
          var medianDataPoints = [];
          var recordingsLat = [];
          var recordingsLng = [];
          var numRecordings = 0;
          setInterval(recordLocation, 10);
          function recordLocation(){
              if (navigator.geolocation) {
              navigator.geolocation.getCurrentPosition(function(position) {
                var pos = {
                  lat: position.coords.latitude,
                  lng: position.coords.longitude
              };

              infoWindow.setPosition(pos);
              infoWindow.setContent(pos.lat + " , " +pos.lng);
              if(shouldCenterMap){
                  map.setCenter(pos);
              }
              recordingsLat.push(pos.lat);
              recordingsLng.push(pos.lng);
              numRecordings++;
              if(numRecordings >= 200){
                recordingsLat.sort();
                recordingsLng.sort();
                var posMedian = {
                  lat: recordingsLat[numRecordings/2],
                  lng: recordingsLng[numRecordings/2]
                  };
                medianDataPoints.push(posMedian);
                
                console.log(posMedian);
                recordingsLat = [];
                recordingsLng = [];
                numRecordings = 0;
                console.log(medianDataPoints);
                       var path = poly.getPath();
                path.push(new google.maps.LatLng(posMedian.lat, posMedian.lng));
                  
              }
              
          }, function() {
            handleLocationError(true, infoWindow, map.getCenter());
        });
          } else {
              // Browser doesn't support Geolocation
              handleLocationError(false, infoWindow, map.getCenter());
          }
              
          }

          
        
      }
    </script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDt2_jkQWKuHl6iy02idQyWXAQTGJLx2io&callback=initMap"
    async defer></script>
    
    
   
  <!-- Modal Structure -->
  <div id="modalwarning" class="modal">
    <div class="modal-content">
      <h4>Add a Warning</h4>
      <p>OMG SO DANGEROUS!!!!!</p>
    </div>
    <div class="modal-footer">
      <a href="#!" class=" modal-action modal-close waves-effect waves-red btn-flat">Cancel</a>
      <a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat">Submit</a>
    </div>
  </div>
    
    <!-- Modal Structure -->
  <div id="modalmusic" class="modal">
    <div class="modal-content">
      <h4>Add a Playlist</h4>
      <p>MUCH MUSIC!!!!</p>
    </div>
    <div class="modal-footer">
      <a href="#!" class=" modal-action modal-close waves-effect waves-red btn-flat">Cancel</a>
      <a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat">Agree</a>
    </div>
  </div>
    
  <!-- Modal Structure -->
  <div id="modalpoi" class="modal">
    <div class="modal-content">
      <h4>Add a Point of Interest</h4>
      <p>MUCH INTERESTING!!!</p>
    </div>
    <div class="modal-footer">
      <a href="#!" class=" modal-action modal-close waves-effect waves-red btn-flat">Cancel</a>
      <a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat">Agree</a>
    </div>
  </div>
    
 
    
    
    <!-- Modal Structure 
        on pressing back while recording the trail.  -->
  <div id="modalrecordthenback" class="modal modal-fixed-footer">
    <div class="modal-content">
      <h4>Are you sure?</h4>
      <p>This will quit your current recording.</p>
    </div>
    <div class="modal-footer">
      <a href="index.html" class="modal-action modal-close waves-effect waves-red btn-flat ">No</a>
      <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat ">Yes</a>
    </div>
  </div>
    
    
    
 
    
    
    


  <!--  Scripts-->
  <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="/js/materialize.js"></script>
  <script src="/js/init.js"></script>
    
   <script>
      $(document).ready(function(){
    // the "href" attribute of .modal-trigger must specify the modal ID that wants to be triggered
    $('.modal').modal();
    $("#recentermap").hide();
          
    $("#recentermap").on("click", function(){
         var centerMap = new Event('centerMap');
         document.dispatchEvent(centerMap);
         
         $(this).delay(2000).hide();
   
    });
         
  });
         
    </script>

  </body>
</html>
